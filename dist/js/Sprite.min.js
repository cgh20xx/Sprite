var preloader=function(t){var i,r={},n={manifest:[],onEachLoad:function(t){console.log("[Preloader] image:"+t.index+" loaded")},onAllLoad:function(t){console.log("[Preloader] all images loaded:"+t)}};for(i in n)t[i]&&(n[i]=t[i]);var e,s,o=n.manifest.length,h=0;function a(t,i,e){var s={id:i,index:++h,img:this,total:o};n.onEachLoad(s),r[i]=s,h==o&&n.onAllLoad(r)}function c(t,i,e){console.error("[Preloader] not found src = "+this.src)}for(s=0;s<o;s+=1)(e=new Image).addEventListener("load",a.bind(e,s,n.manifest[s].id),!1),e.addEventListener("error",c.bind(e,s,n.manifest[s].id),!1),e.src=n.manifest[s].src};function Observer(t){if(t)return Observer.copy(t)}Observer.copy=function(t){for(var i in Observer.prototype)t[i]=Observer.prototype[i];return t},Observer.prototype.on=function(t,i){return this.subscribers=this.subscribers||{},void 0===this.subscribers[t]&&(this.subscribers[t]=[]),this.subscribers[t].push(i),this},Observer.prototype.off=function(t,i){if(this.subscribers=this.subscribers||{},0===arguments.length)return this.subscribers={},this;var e=this.subscribers[t];if(!e)return this;if(1===arguments.length)return delete this.subscribers[t],this;for(var s=e.length-1;0<=s;s--)if(e[s]===i){e.splice(s,1);break}return this},Observer.prototype.trigger=function(t){this.subscribers=this.subscribers||{};var i=[].slice.call(arguments,1),e=this.subscribers[t];return e&&e.forEach(function(t){t.apply(this,i)},this),this},Observer.prototype.listeners=function(t){return this.subscribers=this.subscribers||{},this.subscribers[t]||[]},Observer.prototype.hasListeners=function(t){return!!this.listeners(t).length};var Sprite=function(){var i={fps:12,width:0,height:0,imgBaseUrl:"",imgName:"img",imgType:".jpg",imgStartIndex:0,imgEndIndex:0,repeat:0,autoPlay:!0},s=function(t,i){i=i||{};for(var e in t)"object"==typeof t[e]?(i[e]=t[e].constructor===Array?[]:{},s(t[e],i[e])):i[e]=t[e];return i.uber=t,i};function t(t){this.setting=s(t,i)}return Observer(t.prototype),t.prototype.init=function(){return this.el=document.querySelector(this.setting.el),this.totalFrames=this.setting.imgEndIndex-this.setting.imgStartIndex+1,this.currentFrame=0,this.currentRepeat=0,this.isPlaying=!1,this._preload(),this},t.prototype._preload=function(){for(var i=this,t={manifest:[],onEachLoad:function(t){},onAllLoad:function(t){i.trigger("load",t),i.source=t,i._create()}},e=0;e<this.totalFrames;e++)t.manifest.push({id:this.setting.imgName+(this.setting.imgStartIndex+e),src:this.setting.imgBaseUrl+this.setting.imgName+(this.setting.imgStartIndex+e)+this.setting.imgType});preloader(t)},t.prototype._create=function(){this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.canvas.width=this.setting.width,this.canvas.height=this.setting.height,this.el.appendChild(this.canvas),this.setting.autoPlay&&this.play()},t.prototype._controlAnimation=function(){this.ctx.clearRect(0,0,this.setting.width,this.setting.height);var t=this.setting.imgName+(this.currentFrame+this.setting.imgStartIndex);this.ctx.drawImage(this.source[t].img,0,0,this.setting.width,this.setting.height),this.currentFrame++,this.currentFrame>=this.totalFrames&&(0!==this.setting.repeat&&(this.currentRepeat<=this.setting.repeat||-1===this.setting.repeat)?(this.currentFrame=0,this.currentRepeat++):this.stop())},t.prototype._controlTimer=function(){var t=1e3/this.setting.fps;void 0!==this.setting.duration&&(t=this.setting.duration/this.totalFrames),this.timer=setInterval(this._controlAnimation.bind(this),t)},t.prototype.play=function(){return this.isPlaying&&clearInterval(this.timer),this.trigger("play"),this.currentFrame=0,this.currentRepeat=1,this.isPlaying=!0,this._controlTimer(),this},t.prototype.resume=function(){return this.isPlaying||(this.isPlaying=!0,this.trigger("resume"),this._controlTimer()),this},t.prototype.stop=function(){return this.isPlaying&&(this.isPlaying=!1,this.trigger("stop"),clearInterval(this.timer)),this},t}();